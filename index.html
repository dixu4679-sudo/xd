<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ Â· Healthy Food Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #fff7fa;
      --bg-soft: #ffeef6;
      --card: #ffffff;
      --primary: #ff9fb8;
      --primary-soft: #ffe0ec;
      --accent: #6bcB9b;
      --danger: #ff7675;
      --warning: #f5a623;
      --text-main: #333743;
      --text-sub: #8c8f9b;
      --border-soft: #f2d4e3;
      --shadow-soft: 0 12px 30px rgba(255, 140, 170, 0.12);
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue",
      Arial, "Noto Sans CJK SC", "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #ffe4f1 0, #fff7fa 45%, #fffdfd 100%);
      color: var(--text-main);
    }

    button {
      font-family: inherit;
    }

    /* å…¬å…±æŒ‰é’®æ ·å¼ */
    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 18px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all .15s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff9fb8, #ffb7cf);
      color: #fff;
      box-shadow: 0 8px 20px rgba(255, 140, 170, 0.35);
    }

    .btn-primary:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: rgba(255, 255, 255, 0.8);
      color: var(--primary);
      border: 1px solid var(--primary-soft);
    }

    .btn-ghost:hover {
      background: var(--primary-soft);
    }

    .tag-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      border: 1px solid var(--primary-soft);
      background: #fff;
      color: var(--text-sub);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all .12s ease;
    }

    .tag-pill:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: #ffeef6;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #f3f4f6;
      color: var(--text-sub);
    }

    .text-sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    /* ===== æ¬¢è¿é¡µ ===== */
    .welcome-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
    }

    .welcome-card {
      width: 100%;
      max-width: 520px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 28px;
      padding: 26px 26px 24px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .welcome-card::before {
      content: "";
      position: absolute;
      width: 180px;
      height: 180px;
      background: radial-gradient(circle, rgba(255, 195, 230, 0.7), transparent 70%);
      top: -40px;
      right: -40px;
      opacity: 0.9;
    }

    .welcome-header {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .logo-circle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff9fb8, #ffd6e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .welcome-title-block h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .welcome-subtitle {
      margin: 6px 0 0;
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.5;
    }

    .beta-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255, 159, 184, 0.16);
      color: var(--primary);
    }

    .welcome-body {
      position: relative;
      margin-top: 18px;
    }

    .input-label {
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    .input-field {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #f0d3e2;
      padding: 8px 14px;
      font-size: 14px;
      outline: none;
      transition: all .15s ease;
      background: #fffdfd;
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(255, 140, 170, 0.25);
    }

    .lang-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .lang-options {
      display: inline-flex;
      gap: 6px;
      padding: 3px;
      border-radius: 999px;
      background: #fff4fa;
    }

    .lang-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--text-sub);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all .15s ease;
    }

    .lang-pill.active {
      background: #ff9fb8;
      color: #fff;
      box-shadow: 0 4px 12px rgba(255, 140, 170, 0.4);
    }

    .welcome-footer {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }

    .hint-text {
      font-size: 11px;
      color: var(--text-sub);
    }

    .small-link {
      font-size: 11px;
      color: #b084c8;
    }

    /* ===== ä¸»åº”ç”¨å¸ƒå±€ ===== */
    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px 10px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 8px 18px rgba(255, 173, 203, 0.15);
      backdrop-filter: blur(10px);
    }

    .top-user {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffb7cf, #ffd6e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .top-user-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .top-user-name {
      font-size: 13px;
      font-weight: 600;
    }

    .top-user-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .top-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff0f6;
      color: #d6336c;
    }

    .layout-main {
      flex: 1;
      display: flex;
      gap: 10px;
      margin-top: 4px;
    }

    /* å·¦ä¾§å¯¼èˆª */
    .sidebar {
      width: 210px;
      max-width: 36%;
      background: rgba(255, 238, 246, 0.95);
      border-radius: 20px;
      padding: 14px 10px;
      box-shadow: 0 10px 24px rgba(255, 173, 203, 0.2);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar-title {
      font-size: 12px;
      color: var(--text-sub);
      padding: 0 8px;
      margin-bottom: 4px;
    }

    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      border: 1px solid transparent;
      color: var(--text-main);
      transition: all .12s ease;
    }

    .nav-item span.icon {
      width: 22px;
      text-align: center;
    }

    .nav-item span.label {
      flex: 1;
    }

    .nav-item.active {
      background: #ffccdF;
      border-color: #ffb7cf;
      box-shadow: 0 5px 16px rgba(255, 140, 170, 0.35);
    }

    .nav-item:hover:not(.active) {
      background: #ffedf5;
      border-color: #ffd9e7;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 6px 8px 0;
      border-top: 1px dashed rgba(255, 200, 222, 0.9);
      font-size: 11px;
      color: var(--text-sub);
      line-height: 1.5;
    }

    /* å†…å®¹åŒºåŸŸ */
    .content-area {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 20px;
      padding: 16px 18px 18px;
      box-shadow: 0 10px 26px rgba(255, 173, 203, 0.18);
      border: 1px solid rgba(255, 238, 246, 0.9);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      font-size: 18px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .field-row input {
      flex: 1;
      min-width: 160px;
      border-radius: 999px;
      border: 1px solid #f0d3e2;
      padding: 8px 12px;
      font-size: 14px;
      outline: none;
      transition: all .15s ease;
      background: #fffdfd;
    }

    .field-row input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(255, 140, 170, 0.22);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #f5d3e6;
      padding: 4px 10px;
      font-size: 12px;
      background: #fffafd;
      color: var(--text-sub);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all .12s ease;
    }

    .chip:hover {
      background: #ffeef7;
      border-color: var(--primary);
      color: var(--primary);
    }

    .empty-tip {
      font-size: 13px;
      color: var(--text-sub);
      padding: 4px 0;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .sub-card {
      background: #fff9fc;
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid #f6d7e6;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sub-card-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sub-card-content {
      font-size: 13px;
      color: var(--text-main);
      line-height: 1.5;
    }

    .score-large {
      font-size: 24px;
      font-weight: 700;
    }

    .score-good {
      color: var(--accent);
    }

    .score-mid {
      color: var(--warning);
    }

    .score-bad {
      color: var(--danger);
    }

    .recipes-list {
      margin: 4px 0;
      padding-left: 18px;
      font-size: 13px;
    }

    .recipes-list li {
      margin-bottom: 2px;
    }

    /* ===== æ¸¸æˆåŒºåŸŸ ===== */
    .game-header-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .game-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .game-stat-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #fff0f6;
    }

    .timer-bar-wrapper {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #ffe3ef;
      overflow: hidden;
      margin: 6px 0 10px;
    }

    .timer-bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #6bcb9b, #ff9fb8);
      transition: width 0.2s linear;
    }

    .game-board-wrapper {
      background: #fff9fc;
      border-radius: 18px;
      padding: 10px;
      border: 1px solid #f7d7e8;
    }

    .game-board {
      display: grid;
      gap: 6px;
      justify-content: center;
    }

    .tile {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      background: linear-gradient(145deg, #ffe9f3, #fff5fb);
      border: 1px solid #f5d3e6;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      transition: all .12s ease;
      position: relative;
    }

    .tile span {
      pointer-events: none;
    }

    .tile.empty {
      visibility: hidden;
      cursor: default;
    }

    .tile.selected {
      border-color: #ff9fb8;
      box-shadow: 0 0 0 2px rgba(255, 140, 170, 0.5);
      transform: translateY(-2px);
    }

    .tile.disabled {
      pointer-events: none;
      opacity: 0.4;
    }

    .tip-bubble {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 14px;
      background: #fff1f5;
      border: 1px dashed #f5c2d8;
      font-size: 12px;
      color: var(--text-main);
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }

    .tip-bubble-icon {
      font-size: 16px;
    }

    .tip-bubble-main {
      flex: 1;
    }

    /* æ¸¸æˆç»“æŸå¼¹æ¡†ï¼ˆç®€å•ç‰ˆï¼‰ */
    .game-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .game-overlay-card {
      width: 90%;
      max-width: 360px;
      background: #fff;
      border-radius: 20px;
      padding: 18px 18px 14px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.18);
      text-align: center;
    }

    .game-overlay-title {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .game-overlay-desc {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .game-overlay-stats {
      font-size: 13px;
      margin-bottom: 10px;
    }

    /* ===== ç»Ÿè®¡é¡µé¢ ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .stat-card {
      background: #fff9fc;
      border-radius: 16px;
      padding: 8px 10px;
      border: 1px solid #f7d7e6;
      font-size: 12px;
    }

    .stat-label {
      color: var(--text-sub);
      font-size: 11px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 600;
      margin-top: 2px;
    }

    .leaderboard-list {
      list-style: none;
      margin: 8px 0 0;
      padding: 0;
      font-size: 13px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px dashed #f0d3e2;
    }

    .leaderboard-item span.rank {
      width: 20px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .leaderboard-item span.name {
      flex: 1;
      padding-right: 4px;
    }

    .leaderboard-item span.score {
      font-size: 12px;
      color: var(--primary);
      font-weight: 600;
    }

    /* å“åº”å¼ï¼šçª„å±æ—¶æŠŠä¾§è¾¹æ æ”¾åˆ°é¡¶éƒ¨ */
    @media (max-width: 900px) {
      .layout-main {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        max-width: none;
        flex-direction: row;
        align-items: center;
        padding: 8px 10px;
      }

      .sidebar-title {
        display: none;
      }

      .nav-list {
        flex-direction: row;
        justify-content: space-between;
        flex: 1;
      }

      .nav-item {
        padding: 6px 8px;
        font-size: 12px;
      }

      .sidebar-footer {
        display: none;
      }
    }

    footer {
      margin: 10px 4px 14px;
      text-align: center;
      font-size: 11px;
      color: var(--text-sub);
    }

  </style>
</head>
<body>
<!-- ===== Screen 1: æ¬¢è¿ / ç™»å½• / è¯­è¨€é€‰æ‹© ===== -->
<div id="welcomeScreen" class="welcome-screen">
  <div class="welcome-card">
    <div class="welcome-header">
      <div class="logo-circle">ğŸ¥—</div>
      <div class="welcome-title-block">
        <h1>å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ <span class="beta-tag">mini web</span></h1>
        <p class="welcome-subtitle">
          ç®€å•è®°å½•ä½ çš„é£Ÿç‰©æŸ¥è¯¢ï¼Œè·å¾—æ›´å¥åº·çš„é¥®é£Ÿå»ºè®®ï¼Œ
          è¿˜å¯ä»¥é€šè¿‡å°æ¸¸æˆå­¦ä¸€ç‚¹è¥å…»çŸ¥è¯†ã€‚
        </p>
      </div>
    </div>

    <div class="welcome-body">
      <label class="input-label" for="welcomeName">ğŸ‘¤ æ˜µç§° / å­¦å·</label>
      <input id="welcomeName" class="input-field" type="text" placeholder="ä¾‹å¦‚ï¼šå°ç•ªèŒ„åŒå­¦ã€2025xxxx">

      <div class="lang-row">
        <div>
          <div class="input-label" style="margin-bottom:4px;">ğŸŒ è¯­è¨€ / Language</div>
          <div class="lang-options">
            <button class="lang-pill active" data-lang="cn">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
            <button class="lang-pill" data-lang="kr">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
          </div>
        </div>
      </div>

      <div class="welcome-footer">
        <button id="welcomeStartBtn" class="btn btn-primary">
          â–¶ å¼€å§‹ä½¿ç”¨
        </button>
        <div class="hint-text">
          æç¤ºï¼šç³»ç»Ÿä¼šç”¨ä½ å¡«å†™çš„æ˜µç§°è®°å½•æŸ¥è¯¢è¡Œä¸ºå’Œå°æ¸¸æˆæˆç»©ï¼Œä»…ç”¨äºè¯¾å ‚å±•ç¤ºã€‚
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== Screen 2: ä¸»åº”ç”¨ ===== -->
<div id="mainScreen" class="app-shell" style="display:none;">
  <div class="top-bar">
    <div class="top-user">
      <div class="avatar-circle" id="topAvatar">ğŸ‘¤</div>
      <div class="top-user-text">
        <div class="top-user-name" id="topUserName">æœªç™»å½•</div>
        <div class="top-user-sub" id="topUserSub">æ¬¢è¿æ¥åˆ°å¥åº·é¥®é£Ÿå°åŠ©æ‰‹</div>
      </div>
    </div>
    <div class="top-badge">
      ç»Ÿè®¡å†³ç­– Â· å¥åº·é¥®é£Ÿ Â· Mini Web
    </div>
  </div>

  <div class="layout-main">
    <!-- å·¦ä¾§å¯¼èˆª -->
    <aside class="sidebar">
      <div class="sidebar-title">åŠŸèƒ½ Â· Menu</div>
      <ul class="nav-list">
        <li class="nav-item active" data-page="page-search">
          <span class="icon">ğŸ¥—</span>
          <span class="label">é£Ÿç‰©æŸ¥è¯¢</span>
        </li>
        <li class="nav-item" data-page="page-game">
          <span class="icon">ğŸ®</span>
          <span class="label">è¥å…»è¿è¿çœ‹</span>
        </li>
        <li class="nav-item" data-page="page-stats">
          <span class="icon">ğŸ“Š</span>
          <span class="label">ç»Ÿè®¡ä¸æ’è¡Œæ¦œ</span>
        </li>
      </ul>
      <div class="sidebar-footer">
        æœ¬ç½‘é¡µåº”ç”¨ç”¨äºè¯¾ç¨‹â€œç»Ÿè®¡å†³ç­–â€å±•ç¤ºï¼š<br>
        Â· è®°å½•é£Ÿç‰©æŸ¥è¯¢è¡Œä¸º<br>
        Â· ç»™å‡ºç®€å•å¥åº·è¯„åˆ†ä¸å»ºè®®<br>
        Â· é€šè¿‡å°æ¸¸æˆä¼ é€’è¥å…»çŸ¥è¯†
      </div>
    </aside>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <main class="content-area">
      <!-- é£Ÿç‰©æŸ¥è¯¢é¡µé¢ -->
      <section id="page-search" class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">ğŸ¥—</span>
              <span>é£Ÿç‰©æŸ¥è¯¢ Â· æŸ¥çœ‹çƒ­é‡ä¸å¥åº·è¯„åˆ†</span>
            </div>
            <div class="card-subtitle">
              è¾“å…¥æˆ–é€‰æ‹©å¸¸è§é£Ÿç‰©ï¼Œç³»ç»Ÿä¼šæä¾›çƒ­é‡ã€è¥å…»ç»“æ„ã€å¥åº·è¯„åˆ†å’Œç®€è¦å»ºè®®ã€‚
            </div>
          </div>
          <button class="btn btn-ghost" id="clearSearchResultBtn">æ¸…ç©ºç»“æœ</button>
        </div>

        <div class="field-row">
          <input id="foodInput" type="text" placeholder="è¯·è¾“å…¥é£Ÿç‰©åç§°ï¼Œä¾‹å¦‚ï¼šè‹¹æœã€ç‚¸é¸¡ã€æ‹‰é¢ã€æ²™æ‹‰â€¦" list="foodSuggestions">
          <button class="btn btn-primary" id="searchBtn">æŸ¥è¯¢</button>
        </div>

        <datalist id="foodSuggestions">
          <option value="è‹¹æœ">
          <option value="é¦™è•‰">
          <option value="æ²™æ‹‰">
          <option value="ç‚¸é¸¡">
          <option value="æ‹‰é¢">
          <option value="æ³¡èœæ±¤">
          <option value="ç´«èœåŒ…é¥­">
          <option value="ç‰›æ²¹æœ">
          <option value="ç™½ç±³é¥­">
          <option value="å¯ä¹">
        </datalist>

        <div class="chip-row">
          <span class="chip" data-food="è‹¹æœ">ğŸ è‹¹æœ</span>
          <span class="chip" data-food="ç‚¸é¸¡">ğŸ— ç‚¸é¸¡</span>
          <span class="chip" data-food="æ²™æ‹‰">ğŸ¥— æ²™æ‹‰</span>
          <span class="chip" data-food="æ‹‰é¢">ğŸœ æ‹‰é¢</span>
          <span class="chip" data-food="ç´«èœåŒ…é¥­">ğŸ™ ç´«èœåŒ…é¥­</span>
          <span class="chip" data-food="ç‰›æ²¹æœ">ğŸ¥‘ ç‰›æ²¹æœ</span>
        </div>

        <div id="resultArea">
          <p class="empty-tip">
            ğŸ‘‰ è¿˜æ²¡æœ‰è¿›è¡ŒæŸ¥è¯¢ã€‚å¯ä»¥åœ¨ä¸Šæ–¹è¾“å…¥é£Ÿç‰©åç§°ï¼Œæˆ–ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿä½“éªŒã€‚
            æŸ¥è¯¢è¡Œä¸ºå°†è®°å½•åˆ° Firebase æ•°æ®åº“ä¸­ï¼Œç”¨äºç»Ÿè®¡åˆ†æå’Œæ’è¡Œæ¦œå±•ç¤ºã€‚
          </p>
        </div>
      </section>

      <!-- è¿è¿çœ‹æ¸¸æˆé¡µé¢ -->
      <section id="page-game" class="card" style="display:none;">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">ğŸ®</span>
              <span>è¥å…»è¿è¿çœ‹ Â· Food Link Game</span>
            </div>
            <div class="card-subtitle">
              åœ¨é™å®šæ—¶é—´å†…æ‰¾å‡ºç›¸åŒçš„é£Ÿç‰©å¡ç‰‡å¹¶æ¶ˆé™¤ï¼Œæ¯æˆåŠŸåŒ¹é…ä¸€å¯¹éƒ½ä¼šè§£é”ä¸€å¥è¥å…»å°è´´å£«ã€‚
            </div>
          </div>
          <button class="btn btn-ghost" id="restartGameBtn">é‡æ–°å¼€å§‹</button>
        </div>

        <div class="game-header-row">
          <div class="game-stats">
            <div class="game-stat-pill">
              â± å‰©ä½™æ—¶é—´ï¼š<span id="gameTimeLabel">60s</span>
            </div>
            <div class="game-stat-pill">
              âœ… å·²åŒ¹é…ï¼š<span id="gameMatchedLabel">0</span> å¯¹
            </div>
            <div class="game-stat-pill">
              ğŸ’¡ å·²è§£é”è¥å…»æç¤ºï¼š<span id="gameTipsLabel">0</span> æ¡
            </div>
          </div>
          <button class="btn btn-primary" id="startGameBtn">â–¶ å¼€å§‹æ¸¸æˆ</button>
        </div>

        <div class="timer-bar-wrapper">
          <div id="timerBar" class="timer-bar"></div>
        </div>

        <div class="game-board-wrapper">
          <div id="gameBoard" class="game-board">
            <!-- æ£‹ç›˜æ ¼å­ç”± JS åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>

        <div id="gameTipBubble" class="tip-bubble" style="display:none;">
          <div class="tip-bubble-icon">ğŸ’¡</div>
          <div class="tip-bubble-main">
            <div id="gameTipFood" style="font-weight:600;"></div>
            <div id="gameTipText" class="text-sub" style="margin-top:2px;"></div>
          </div>
        </div>
      </section>

      <!-- ç»Ÿè®¡ä¸æ’è¡Œæ¦œé¡µé¢ -->
      <section id="page-stats" class="card" style="display:none;">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">ğŸ“Š</span>
              <span>ç»Ÿè®¡ä¸æ’è¡Œæ¦œ Â· Stats & Ranking</span>
            </div>
            <div class="card-subtitle">
              ç»“åˆ Firebase æ•°æ®åº“ï¼Œå¯¹ç”¨æˆ·çš„é£Ÿç‰©æŸ¥è¯¢è¡Œä¸ºè¿›è¡Œç®€å•ç»Ÿè®¡ï¼Œç”¨ä½œç»Ÿè®¡å†³ç­–è¯¾ç¨‹çš„æ¼”ç¤ºç¤ºä¾‹ã€‚
            </div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">å½“å‰ç”¨æˆ·ç´¯è®¡æŸ¥è¯¢æ¬¡æ•°</div>
            <div id="statTotal" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å½“å‰ç”¨æˆ·å¹³å‡å¥åº·è¯„åˆ†</div>
            <div id="statAvgScore" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å¥åº·æ¨èæ¬¡æ•°ï¼ˆè¯„åˆ†â‰¥80ï¼‰</div>
            <div id="statHigh" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">éœ€è¦æ³¨æ„çš„æ¬¡æ•°ï¼ˆè¯„åˆ†&lt;60ï¼‰</div>
            <div id="statLow" class="stat-value">0</div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div class="sub-card-title">
            ğŸ† å…¨ä½“ç”¨æˆ·å¥åº·æŸ¥è¯¢æ’è¡Œæ¦œ TOP 10
          </div>
          <ul id="leaderboardList" class="leaderboard-list">
            <li class="empty-tip">æš‚æ—¶æ²¡æœ‰æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œå‡ æ¬¡é£Ÿç‰©æŸ¥è¯¢ã€‚</li>
          </ul>
          <p class="text-sub" style="margin-top:6px;">
            æ’è¡Œæ¦œæŒ‰â€œå¥åº·æ¨èâ€é£Ÿç‰©çš„ç´¯è®¡æŸ¥è¯¢æ¬¡æ•°æ’åºï¼Œåªä½œä¸ºæœ¬è¯¾ç¨‹çš„ç®€å•æ¼”ç¤ºã€‚
          </p>
        </div>
      </section>
    </main>
  </div>

  <footer>
    Â© 2025 å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ Â· ä½¿ç”¨ Firebase Realtime Database & ç®€å•æ¸¸æˆåŒ–è®¾è®¡ä½œä¸ºç»Ÿè®¡å†³ç­–ç¤ºä¾‹
  </footer>
</div>

<!-- ===== Firebase & Chart.js ===== -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- æ¸¸æˆç»“æŸå¼¹çª— -->
<div id="gameOverlay" class="game-overlay">
  <div class="game-overlay-card">
    <div class="game-overlay-title" id="gameOverlayTitle">æœ¬å±€ç»“æŸ</div>
    <div class="game-overlay-desc" id="gameOverlayDesc"></div>
    <div class="game-overlay-stats" id="gameOverlayStats"></div>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:4px;">
      <button class="btn btn-primary" id="overlayRestartBtn">å†ç©ä¸€å±€</button>
      <button class="btn btn-ghost" id="overlayCloseBtn">è¿”å›é¡µé¢</button>
    </div>
  </div>
</div>

<script>
  // ===== Firebase é…ç½®ï¼ˆä½ çš„é¡¹ç›®ï¼‰ =====
  const firebaseConfig = {
    apiKey: "AIzaSyBCrHD2f3beCX83FZwpCCqMf2lT7WeF8Lg",
    authDomain: "healthy-eating-and-recreation.firebaseapp.com",
    databaseURL: "https://healthy-eating-and-recreation-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "healthy-eating-and-recreation",
    storageBucket: "healthy-eating-and-recreation.appspot.com",
    messagingSenderId: "282757556302",
    appId: "1:282757556302:web:df373651ffe71efca1bb1f",
    measurementId: "G-BPG2KSLHF7"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ===== å…¨å±€çŠ¶æ€ =====
  let currentUserName = "Guest";
  let currentUserKey = "Guest";
  let currentLang = "cn"; // "cn" or "kr"

  // é£Ÿç‰©æ•°æ®
  const FOOD_DATA = {
    "è‹¹æœ": {
      nameCN: "è‹¹æœ",
      nameEN: "Apple",
      emoji: "ğŸ",
      kcal: 52,
      carbs: 14,
      protein: 0.3,
      fat: 0.2,
      fiber: 2.4,
      category: "æ°´æœ",
      healthLevel: "high",
      tips: "å¯Œå«è†³é£Ÿçº¤ç»´å’Œç»´ç”Ÿç´ Cï¼Œå¯ä½œä¸ºåŠ é¤æˆ–æ—©é¤æ°´æœã€‚",
      recipes: [
        "é…¸å¥¶æ°´æœç¢—ï¼šåŸå‘³é…¸å¥¶ + è‹¹æœç‰‡ + ç‡•éº¦ + åšæœã€‚",
        "åˆ‡å—å’Œå…¶ä»–æ°´æœä¸€èµ·åšæˆå½©è™¹æ°´æœç›˜ã€‚"
      ]
    },
    "é¦™è•‰": {
      nameCN: "é¦™è•‰",
      nameEN: "Banana",
      emoji: "ğŸŒ",
      kcal: 89,
      carbs: 23,
      protein: 1.1,
      fat: 0.3,
      fiber: 2.6,
      category: "æ°´æœ",
      healthLevel: "medium",
      tips: "èƒ½é‡å¯†åº¦è¾ƒé«˜ï¼Œé€‚åˆè¿åŠ¨å‰åè¡¥å……èƒ½é‡ï¼Œå‡è„‚æœŸéœ€æ³¨æ„æ€»é‡ã€‚",
      recipes: [
        "é¦™è•‰èŠ±ç”Ÿé…±å…¨éº¦åå¸ï¼šç®€å•åˆé¡¶é¥±ã€‚",
        "å†»é¦™è•‰åˆ‡å—æ‰“æˆå¥¶æ˜”ï¼ŒåŠ å°‘é‡ç‰›å¥¶å³å¯ã€‚"
      ]
    },
    "æ²™æ‹‰": {
      nameCN: "è”¬èœæ²™æ‹‰",
      nameEN: "Green Salad",
      emoji: "ğŸ¥—",
      kcal: 35,
      carbs: 5,
      protein: 1.5,
      fat: 1,
      fiber: 2.5,
      category: "è”¬èœ/è½»é£Ÿ",
      healthLevel: "high",
      tips: "ä¼˜å…ˆé€‰æ‹©æ©„æ¦„æ²¹ã€æŸ æª¬æ±ç­‰æ¸…çˆ½é…±æ±ï¼Œé¿å…é«˜ç³–é«˜è„‚æ²™æ‹‰é…±ã€‚",
      recipes: [
        "é¸¡èƒ¸è‚‰æ··åˆè”¬èœæ²™æ‹‰ï¼šé«˜è›‹ç™½ä½è„‚è‚ªã€‚",
        "åŠ å…¥ç‰›æ²¹æœå’Œåšæœï¼Œåšæˆä¸€ä»½æ›´æœ‰é¥±è…¹æ„Ÿçš„æ²™æ‹‰ç¢—ã€‚"
      ]
    },
    "ç‚¸é¸¡": {
      nameCN: "ç‚¸é¸¡",
      nameEN: "Fried Chicken",
      emoji: "ğŸ—",
      kcal: 260,
      carbs: 8,
      protein: 18,
      fat: 17,
      fiber: 0,
      category: "æ²¹ç‚¸é£Ÿå“",
      healthLevel: "low",
      tips: "é«˜è„‚ã€é«˜çƒ­é‡ï¼Œå»ºè®®å¶å°”å°‘é‡äº«ç”¨ï¼Œå¯ç”¨çƒ¤ç®±ç‰ˆé¸¡å—æ›¿ä»£éƒ¨åˆ†æ²¹ç‚¸ã€‚",
      recipes: [
        "çƒ¤ç®±ä½æ²¹é¸¡å—ï¼šç”¨å°‘é‡æ²¹å’Œç©ºæ°”ç‚¸é”…/çƒ¤ç®±åˆ¶ä½œã€‚",
        "æ­é…ä¸€å¤§ä»½æ²™æ‹‰å’Œæ— ç³–é¥®æ–™ï¼Œå¹³è¡¡æ•´é¤ã€‚"
      ]
    },
    "æ‹‰é¢": {
      nameCN: "æ–¹ä¾¿æ‹‰é¢",
      nameEN: "Instant Ramen",
      emoji: "ğŸœ",
      kcal: 450,
      carbs: 60,
      protein: 9,
      fat: 17,
      fiber: 3,
      category: "ä¸»é£Ÿ/å¿«é¤",
      healthLevel: "low",
      tips: "é’ å«é‡å’Œè„‚è‚ªè¾ƒé«˜ï¼Œå¯åªç”¨ä¸€åŠè°ƒæ–™åŒ…ï¼Œå¹¶åŠ å…¥è”¬èœä¸è›‹ã€‚",
      recipes: [
        "æ‹‰é¢ä¸­åŠ å…¥é’èœã€è˜‘è‡ã€é¸¡è›‹ï¼Œå‡å°‘è°ƒæ–™åŒ…ä½¿ç”¨é‡ã€‚",
        "æ‹‰é¢ä¸€åŠé¢é…ä¸€åŠè”¬èœï¼Œè®©ç¢—é‡Œé¢œè‰²æ›´ä¸°å¯Œã€‚"
      ]
    },
    "æ³¡èœæ±¤": {
      nameCN: "æ³¡èœæ±¤",
      nameEN: "Kimchi Stew",
      emoji: "ğŸ²",
      kcal: 80,
      carbs: 6,
      protein: 6,
      fat: 3,
      fiber: 1.5,
      category: "éŸ©å¼èœè‚´",
      healthLevel: "medium",
      tips: "æ­é…é€‚é‡ç±³é¥­ã€è±†è…å’Œç˜¦è‚‰ï¼Œå¯æˆä¸ºè¾ƒå‡è¡¡çš„ä¸€é¤ï¼Œæ³¨æ„æ•´ä½“ç›åˆ†æ‘„å…¥ã€‚",
      recipes: [
        "è±†è…çŒªè‚‰æ³¡èœæ±¤ï¼šè±†è…å¢åŠ è›‹ç™½è´¨ï¼Œå°‘æ²¹æ›´æ¸…çˆ½ã€‚",
        "ç”¨è˜‘è‡ã€è”¬èœæ›¿ä»£éƒ¨åˆ†è‚‰ç±»ï¼Œå‡å°‘èƒ½é‡ã€‚"
      ]
    },
    "ç´«èœåŒ…é¥­": {
      nameCN: "ç´«èœåŒ…é¥­",
      nameEN: "Gimbap",
      emoji: "ğŸ™",
      kcal: 200,
      carbs: 30,
      protein: 5,
      fat: 6,
      fiber: 2,
      category: "ä¸»é£Ÿ/ä¾¿å½“",
      healthLevel: "medium",
      tips: "å¤šä½¿ç”¨è”¬èœå’Œé¸¡è›‹ä¸ºä¸»çš„å†…é¦…ï¼Œå°‘ç”¨ç«è…¿ã€é¦™è‚ ç­‰åŠ å·¥è‚‰ã€‚",
      recipes: [
        "è”¬èœé¸¡è›‹ç´«èœåŒ…é¥­ï¼šèƒ¡èåœã€é»„ç“œã€é¸¡è›‹ä¸ºä¸»ã€‚",
        "å‡å°‘ç±³é¥­é‡ï¼Œå¢åŠ è”¬èœæ¯”ä¾‹ï¼Œä½œä¸ºè½»åˆé¤ã€‚"
      ]
    },
    "ç‰›æ²¹æœ": {
      nameCN: "ç‰›æ²¹æœ",
      nameEN: "Avocado",
      emoji: "ğŸ¥‘",
      kcal: 160,
      carbs: 9,
      protein: 2,
      fat: 15,
      fiber: 7,
      category: "ä¼˜è´¨è„‚è‚ª",
      healthLevel: "high",
      tips: "å¯Œå«å•ä¸é¥±å’Œè„‚è‚ªé…¸å’Œè†³é£Ÿçº¤ç»´ï¼Œé€‚é‡æ‘„å…¥æœ‰åˆ©äºå¿ƒè¡€ç®¡å¥åº·ã€‚",
      recipes: [
        "ç‰›æ²¹æœé¸¡è›‹åå¸ï¼šæ­é…å…¨éº¦é¢åŒ…æ›´æœ‰é¥±è…¹æ„Ÿã€‚",
        "åˆ‡ç‰‡æ’’ç›å’Œé»‘èƒ¡æ¤’ï¼Œåšæˆç®€å•çš„ç‰›æ²¹æœå°åƒã€‚"
      ]
    },
    "ç™½ç±³é¥­": {
      nameCN: "ç™½ç±³é¥­",
      nameEN: "White Rice",
      emoji: "ğŸš",
      kcal: 130,
      carbs: 28,
      protein: 2.4,
      fat: 0.3,
      fiber: 0.4,
      category: "ä¸»é£Ÿ",
      healthLevel: "medium",
      tips: "æ§åˆ¶ä»½é‡ã€æ­é…è›‹ç™½è´¨ä¸è”¬èœï¼Œç™½ç±³é¥­ä¹Ÿå¯ä»¥æ˜¯å¥åº·é¥®é£Ÿçš„ä¸€éƒ¨åˆ†ã€‚",
      recipes: [
        "ä¸€ç¢—ç±³é¥­ + ä¸€ä»½çƒ¤é¸¡èƒ¸è‚‰ + ä¸€ä»½ç‚’è”¬èœï¼Œæ„æˆç®€æ˜“å‡è¡¡ä¸€é¤ã€‚",
        "ç”¨ç³™ç±³æˆ–æ‚ç²®æ›¿ä»£éƒ¨åˆ†ç™½ç±³ï¼Œå¢åŠ è†³é£Ÿçº¤ç»´ã€‚"
      ]
    },
    "å¯ä¹": {
      nameCN: "å¯ä¹é¥®æ–™",
      nameEN: "Cola",
      emoji: "ğŸ¥¤",
      kcal: 42,
      carbs: 11,
      protein: 0,
      fat: 0,
      fiber: 0,
      category: "å«ç³–é¥®æ–™",
      healthLevel: "low",
      tips: "ä¸»è¦æä¾›ç³–å’Œçƒ­é‡ï¼Œè¥å…»ä»·å€¼æœ‰é™ï¼Œå»ºè®®å‡å°‘é¢‘ç‡ï¼Œå¯é€‰æ‹©æ— ç³–é¥®æ–™æˆ–ç™½å¼€æ°´æ›¿ä»£ã€‚",
      recipes: [
        "è¯•è¯•æ— ç³–æ°”æ³¡æ°´ + æŸ æª¬ç‰‡ä»£æ›¿å«ç³–é¥®æ–™ã€‚",
        "ç”¨å†·æ³¡èŒ¶ä½œä¸ºæ—¥å¸¸é¥®ç”¨æ°´ï¼Œæ›´æ— è´Ÿæ‹…ã€‚"
      ]
    }
  };

  // æ¸¸æˆç”¨è¥å…»æç¤ºï¼ˆå¯å’Œ FOOD_DATA ä¸€è‡´ï¼‰
  const NUTRITION_TIPS = {
    "è‹¹æœ": "è‹¹æœå¯Œå«è†³é£Ÿçº¤ç»´å’Œç»´ç”Ÿç´ Cï¼Œè¿çš®åƒæ›´èƒ½å¢åŠ çº¤ç»´æ‘„å…¥ã€‚",
    "é¦™è•‰": "é¦™è•‰å«æœ‰è¾ƒå¤šç¢³æ°´å’Œé’¾ï¼Œé€‚åˆè¿åŠ¨å‰åè¡¥å……èƒ½é‡ã€‚",
    "æ²™æ‹‰": "è”¬èœæ²™æ‹‰æœ¬èº«èƒ½é‡ä¸é«˜ï¼Œé…±æ±æ‰æ˜¯å…³é”®ï¼Œå°½é‡é€‰æ‹©æ¸…çˆ½å‹ã€‚",
    "ç‚¸é¸¡": "ç‚¸é¸¡æ²¹è„‚è¾ƒé«˜ï¼Œå¯ä»¥æ­é…æ²™æ‹‰å’Œæ— ç³–é¥®æ–™ï¼Œç¨å¾®å¹³è¡¡ä¸€ä¸‹æ•´é¤ã€‚",
    "æ‹‰é¢": "æ–¹ä¾¿æ‹‰é¢é’ å«é‡å’Œè„‚è‚ªåé«˜ï¼ŒåŠ è”¬èœå’Œè›‹èƒ½è®©å®ƒç¨å¾®å‡è¡¡ä¸€äº›ã€‚",
    "æ³¡èœæ±¤": "æ³¡èœæ±¤å‘³é“é‡ï¼Œæ³¨æ„æ­é…å°‘ç›çš„å°èœå’Œé€‚é‡ç±³é¥­ã€‚",
    "ç´«èœåŒ…é¥­": "ç´«èœåŒ…é¥­ä¸­ç±³é¥­æ¯”ä¾‹å¾€å¾€åé«˜ï¼Œå¯ä»¥å¤šåŠ è”¬èœã€å°‘ä¸€ç‚¹ç±³é¥­ã€‚",
    "ç‰›æ²¹æœ": "ç‰›æ²¹æœæ˜¯å¥åº·è„‚è‚ªæ¥æºï¼Œä½†èƒ½é‡ä¹Ÿé«˜ï¼Œæ¯å¤©å››åˆ†ä¹‹ä¸€åˆ°äºŒåˆ†ä¹‹ä¸€å°±å¤Ÿäº†ã€‚",
    "ç™½ç±³é¥­": "ç™½ç±³é¥­æœ¬èº«ä¸â€œèƒ–äººâ€ï¼Œå…³é”®æ˜¯ä»½é‡ä¸æ­é…ã€‚",
    "å¯ä¹": "å«ç³–é¥®æ–™å®¹æ˜“å¸¦æ¥é¢å¤–çƒ­é‡ï¼Œæ”¹æˆæ— ç³–æˆ–ç™½æ°´æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚"
  };

  // ä¼šè¯å†…åˆ†ç±»ç»Ÿè®¡ï¼ˆå¯ç”¨äºæ‰©å±•å›¾è¡¨ï¼‰
  const sessionCategoryCount = {};

  // ===== DOM =====
  const welcomeScreen = document.getElementById("welcomeScreen");
  const mainScreen = document.getElementById("mainScreen");
  const welcomeNameInput = document.getElementById("welcomeName");
  const welcomeStartBtn = document.getElementById("welcomeStartBtn");
  const langPills = document.querySelectorAll(".lang-pill");

  const topUserNameLabel = document.getElementById("topUserName");
  const topUserSubLabel = document.getElementById("topUserSub");

  // å¯¼èˆª
  const navItems = document.querySelectorAll(".nav-item");
  const pageSearch = document.getElementById("page-search");
  const pageGame = document.getElementById("page-game");
  const pageStats = document.getElementById("page-stats");

  // é£Ÿç‰©æŸ¥è¯¢
  const foodInput = document.getElementById("foodInput");
  const searchBtn = document.getElementById("searchBtn");
  const chips = document.querySelectorAll(".chip");
  const resultArea = document.getElementById("resultArea");
  const clearSearchResultBtn = document.getElementById("clearSearchResultBtn");

  // ç»Ÿè®¡ DOM
  const statTotal = document.getElementById("statTotal");
  const statAvgScore = document.getElementById("statAvgScore");
  const statHigh = document.getElementById("statHigh");
  const statLow = document.getElementById("statLow");
  const leaderboardList = document.getElementById("leaderboardList");

  // æ¸¸æˆ DOM
  const gameTimeLabel = document.getElementById("gameTimeLabel");
  const gameMatchedLabel = document.getElementById("gameMatchedLabel");
  const gameTipsLabel = document.getElementById("gameTipsLabel");
  const timerBar = document.getElementById("timerBar");
  const gameBoard = document.getElementById("gameBoard");
  const startGameBtn = document.getElementById("startGameBtn");
  const restartGameBtn = document.getElementById("restartGameBtn");
  const gameTipBubble = document.getElementById("gameTipBubble");
  const gameTipFood = document.getElementById("gameTipFood");
  const gameTipText = document.getElementById("gameTipText");

  const gameOverlay = document.getElementById("gameOverlay");
  const gameOverlayTitle = document.getElementById("gameOverlayTitle");
  const gameOverlayDesc = document.getElementById("gameOverlayDesc");
  const gameOverlayStats = document.getElementById("gameOverlayStats");
  const overlayRestartBtn = document.getElementById("overlayRestartBtn");
  const overlayCloseBtn = document.getElementById("overlayCloseBtn");

  // ç»Ÿè®¡ç›¸å…³
  function sanitizeKey(str) {
    return String(str).replace(/[.#$[\]]/g, "_");
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, m => {
      switch (m) {
        case "&": return "&amp;";
        case "<": return "&lt;";
        case ">": return "&gt;";
        case '"': return "&quot;";
        case "'": return "&#39;";
        default: return m;
      }
    });
  }

  // ===== æ¬¢è¿é¡µé€»è¾‘ =====
  langPills.forEach(pill => {
    pill.addEventListener("click", () => {
      langPills.forEach(p => p.classList.remove("active"));
      pill.classList.add("active");
      currentLang = pill.getAttribute("data-lang") || "cn";
    });
  });

  welcomeStartBtn.addEventListener("click", () => {
    const name = welcomeNameInput.value.trim();
    if (!name) {
      alert("è¯·å…ˆè¾“å…¥ä¸€ä¸ªæ˜µç§°æˆ–å­¦å·ï¼Œä¾‹å¦‚â€œå°ç•ªèŒ„åŒå­¦â€ã€‚");
      welcomeNameInput.focus();
      return;
    }
    currentUserName = name;
    currentUserKey = sanitizeKey(name);
    topUserNameLabel.textContent = name;
    topUserSubLabel.textContent = "æ¬¢è¿å›æ¥ï¼Œä»Šå¤©ä¹Ÿè¦å¥½å¥½åƒé¥­ï½";
    welcomeScreen.style.display = "none";
    mainScreen.style.display = "flex";

    // åˆæ¬¡è¿›å…¥æ—¶æ‹‰ä¸€æ¬¡è¯¥ç”¨æˆ·ç»Ÿè®¡
    fetchUserStatsOnce();
  });

  welcomeNameInput.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      welcomeStartBtn.click();
    }
  });

  // ===== å¯¼èˆªåˆ‡æ¢ =====
  function showPage(id) {
    pageSearch.style.display = (id === "page-search") ? "block" : "none";
    pageGame.style.display = (id === "page-game") ? "block" : "none";
    pageStats.style.display = (id === "page-stats") ? "block" : "none";
  }

  navItems.forEach(item => {
    item.addEventListener("click", () => {
      navItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      const pageId = item.getAttribute("data-page");
      showPage(pageId);
    });
  });

  // é»˜è®¤å±•ç¤ºæŸ¥è¯¢é¡µ
  showPage("page-search");

  // ===== é£Ÿç‰©æŸ¥è¯¢é€»è¾‘ =====
  searchBtn.addEventListener("click", () => {
    const name = foodInput.value.trim();
    if (!name) {
      alert("è¯·è¾“å…¥é£Ÿç‰©åç§°ã€‚");
      return;
    }
    handleSearch(name);
  });

  foodInput.addEventListener("keydown", e => {
    if (e.key === "Enter") searchBtn.click();
  });

  chips.forEach(chip => {
    chip.addEventListener("click", () => {
      const foodName = chip.getAttribute("data-food");
      foodInput.value = foodName;
      handleSearch(foodName);
    });
  });

  clearSearchResultBtn.addEventListener("click", () => {
    resultArea.innerHTML = '<p class="empty-tip">ğŸ‘‰ å·²æ¸…ç©ºç»“æœï¼Œè¯·é‡æ–°è¾“å…¥é£Ÿç‰©åç§°è¿›è¡ŒæŸ¥è¯¢ã€‚</p>';
  });

  function computeHealthScore(food) {
    let base = 70;
    if (food.healthLevel === "high") base = 90;
    else if (food.healthLevel === "medium") base = 70;
    else base = 50;

    if (food.kcal > 300) base -= 10;
    if (food.kcal > 450) base -= 15;
    if (food.kcal < 120 && food.healthLevel !== "low") base += 5;

    if (food.category === "å«ç³–é¥®æ–™") base -= 10;
    if (food.category === "æ²¹ç‚¸é£Ÿå“") base -= 5;

    return Math.max(0, Math.min(100, base));
  }

  function getScoreClass(score) {
    if (score >= 80) return "score-large score-good";
    if (score >= 60) return "score-large score-mid";
    return "score-large score-bad";
  }

  function getScoreText(score) {
    if (score >= 80) return "å¥åº·æ¨è";
    if (score >= 60) return "é€‚é‡é£Ÿç”¨";
    return "æ³¨æ„æ§åˆ¶";
  }

  function getSuggestionText(score, food) {
    if (score >= 80) {
      return "æ€»ä½“è€Œè¨€è¯¥é£Ÿç‰©è¾ƒä¸ºå¥åº·ï¼Œå¯ä»¥ç»å¸¸å‡ºç°åœ¨æ—¥å¸¸é¥®é£Ÿä¸­ï¼Œä½†ä»éœ€æ³¨æ„ä»½é‡ä¸æ•´ä½“èƒ½é‡å¹³è¡¡ã€‚";
    } else if (score >= 60) {
      return "é€‚åˆä½œä¸ºå¶å°”æˆ–é€‚é‡é€‰æ‹©ï¼Œå»ºè®®ä¸è”¬èœã€è›‹ç™½è´¨ç±»é£Ÿç‰©æ­é…ï¼Œä¸è¦æ•´é¤åªåƒè¿™ä¸€ç§ã€‚";
    } else {
      if (food.category === "å«ç³–é¥®æ–™") {
        return "è¯¥é¥®æ–™ä¸»è¦æä¾›ç³–å’Œçƒ­é‡ï¼Œè¥å…»ä»·å€¼æœ‰é™ã€‚å¯ä»¥åœ¨æŠ¥å‘Šä¸­å°†å…¶å½’ç±»ä¸ºâ€œé«˜é£é™©é€‰æ‹©â€ï¼Œå»ºè®®å‡å°‘é¢‘ç‡ã€‚";
      }
      if (food.category === "æ²¹ç‚¸é£Ÿå“" || food.category === "ä¸»é£Ÿ/å¿«é¤") {
        return "èƒ½é‡å’Œè„‚è‚ªå«é‡åé«˜ï¼Œå»ºè®®æ§åˆ¶é£Ÿç”¨é¢‘ç‡å’Œä»½é‡ï¼Œå¤šæ­é…è”¬èœå’Œæ— ç³–é¥®å“ã€‚";
      }
      return "ç»¼åˆè¥å…»ç»“æ„æ¥çœ‹ï¼Œè¯¥é£Ÿç‰©éœ€è¦æ³¨æ„æ‘„å…¥çš„é¢‘ç‡å’Œæ€»é‡ï¼Œå¯ä¸ä½èƒ½é‡ã€é«˜è†³é£Ÿçº¤ç»´çš„é£Ÿç‰©æ­é…ã€‚";
    }
  }

  function handleSearch(rawName) {
    const key = rawName.replace(/\s+/g, "");
    const food = FOOD_DATA[key];
    if (!food) {
      resultArea.innerHTML = `
        <p class="empty-tip">
          æš‚æœªæ”¶å½• <strong>${escapeHtml(rawName)}</strong> çš„è¯¦ç»†ä¿¡æ¯ã€‚<br>
          å¯ä»¥å°è¯•â€œè‹¹æœã€æ²™æ‹‰ã€ç‚¸é¸¡ã€æ‹‰é¢â€ç­‰å¸¸è§é£Ÿç‰©åç§°ã€‚
        </p>
      `;
      return;
    }

    const healthScore = computeHealthScore(food);
    const suggestion = getSuggestionText(healthScore, food);

    // æ›´æ–°ä¼šè¯åˆ†ç±»ç»Ÿè®¡
    sessionCategoryCount[food.category] = (sessionCategoryCount[food.category] || 0) + 1;

    // æ¸²æŸ“ç»“æœï¼šæ‹†æˆä¸‰å¼ å¡ç‰‡
    const scoreClass = getScoreClass(healthScore);
    const scoreText = getScoreText(healthScore);

    const recipesHtml = (food.recipes || []).length
      ? `<ul class="recipes-list">${food.recipes.map(r => `<li>${escapeHtml(r)}</li>`).join("")}</ul>`
      : `<p class="text-sub">æš‚æœªæä¾›å…·ä½“åƒæ³•ï¼Œå¯è‡ªè¡Œåœ¨è¯¾å ‚æŠ¥å‘Šä¸­è¡¥å……ã€‚</p>`;

    resultArea.innerHTML = `
      <div class="result-grid">
        <!-- å¡ç‰‡ 1ï¼šåŸºç¡€ä¿¡æ¯ä¸è¥å…»ç»“æ„ -->
        <div class="sub-card">
          <div class="sub-card-title">
            <span>${food.emoji || "ğŸ½"}</span>
            <span>é£Ÿç‰©ä¿¡æ¯ä¸è¥å…»ç»“æ„</span>
          </div>
          <div class="sub-card-content">
            <div>
              <strong>${escapeHtml(food.nameCN)}</strong>
              <span class="badge">${escapeHtml(food.nameEN)}</span>
            </div>
            <div class="text-sub" style="margin-top:4px;">
              ç±»åˆ«ï¼š${escapeHtml(food.category)}
            </div>
            <div style="margin-top:6px;">
              ğŸ”¥ çƒ­é‡ï¼š<strong>${food.kcal}</strong> kcal / 100g<br>
              ğŸŒ¾ ç¢³æ°´ï¼š${food.carbs} g Â· ğŸ¥š è›‹ç™½è´¨ï¼š${food.protein} g Â· ğŸ¥‘ è„‚è‚ªï¼š${food.fat} g<br>
              ğŸŒ± è†³é£Ÿçº¤ç»´ï¼š${food.fiber} g
            </div>
          </div>
        </div>

        <!-- å¡ç‰‡ 2ï¼šå¥åº·è¯„åˆ†ä¸å»ºè®® -->
        <div class="sub-card">
          <div class="sub-card-title">
            <span>ğŸ’“</span>
            <span>å¥åº·è¯„åˆ†ä¸ç®€å•å»ºè®®</span>
          </div>
          <div class="sub-card-content">
            <div>
              å¥åº·è¯„åˆ†ï¼š
              <span class="${scoreClass}">${healthScore.toFixed(0)}</span>
              / 100
              <span class="badge">${scoreText}</span>
            </div>
            <div class="text-sub" style="margin-top:4px;">
              è¯„åˆ†ä¾æ®ï¼ˆå¯åœ¨æŠ¥å‘Šä¸­è¯´æ˜ï¼‰ï¼šç»¼åˆè€ƒè™‘èƒ½é‡å¯†åº¦ã€é£Ÿç‰©ç±»åˆ«ä»¥åŠæ˜¯å¦ä¸ºå«ç³–é¥®æ–™ / æ²¹ç‚¸é£Ÿå“ç­‰å› ç´ æ„å»ºçš„ç®€åŒ–æ¨¡å‹ã€‚
            </div>
            <div style="margin-top:6px;">
              å»ºè®®ï¼š${escapeHtml(suggestion)}
            </div>
          </div>
        </div>

        <!-- å¡ç‰‡ 3ï¼šæ¨èåƒæ³• -->
        <div class="sub-card">
          <div class="sub-card-title">
            <span>ğŸ½</span>
            <span>æ¨èåƒæ³•ï¼ˆç¤ºä¾‹ï¼‰</span>
          </div>
          <div class="sub-card-content">
            ${recipesHtml}
            <div class="text-sub" style="margin-top:4px;">
              è¯´æ˜ï¼šæœ¬ç³»ç»Ÿä»…ç»™å‡ºç¤ºä¾‹æ€§æ­é…æ–¹æ¡ˆï¼Œé¼“åŠ±å­¦ç”Ÿåœ¨æŠ¥å‘Šä¸­è¿›ä¸€æ­¥æŸ¥æ‰¾æ–‡çŒ®å¹¶è¡¥å……æ›´ä¸“ä¸šçš„é¥®é£Ÿå»ºè®®ã€‚
            </div>
          </div>
        </div>
      </div>
    `;

    // å†™å…¥ Firebase æ—¥å¿— & æ›´æ–°ç»Ÿè®¡
    const payload = {
      user: currentUserName || "Guest",
      userKey: currentUserKey,
      foodKey: key,
      foodName: food.nameCN,
      category: food.category,
      healthScore,
      healthLevel: food.healthLevel,
      timestamp: Date.now()
    };

    try {
      db.ref("foodSearchLogs").push(payload);
      updateUserStats(currentUserKey, healthScore);
    } catch (e) {
      console.warn("å†™å…¥ Firebase å‡ºé”™ï¼š", e);
    }
  }

  // ===== ç”¨æˆ·ç»Ÿè®¡ userStats/{userKey} =====
  function renderUserStats(stat) {
    if (!stat) {
      statTotal.textContent = "0";
      statAvgScore.textContent = "0";
      statHigh.textContent = "0";
      statLow.textContent = "0";
      return;
    }
    statTotal.textContent = stat.total || 0;
    const avg = stat.total > 0 ? (stat.sumScore / stat.total).toFixed(1) : "0";
    statAvgScore.textContent = avg;
    statHigh.textContent = stat.high || 0;
    statLow.textContent = stat.low || 0;
  }

  function updateUserStats(userKey, healthScore) {
    const ref = db.ref("userStats/" + userKey);
    ref.transaction(stat => {
      if (!stat) {
        stat = {
          userName: currentUserName || "Guest",
          total: 0,
          sumScore: 0,
          high: 0,
          mid: 0,
          low: 0
        };
      }
      stat.total += 1;
      stat.sumScore += healthScore;
      if (healthScore >= 80) stat.high += 1;
      else if (healthScore >= 60) stat.mid += 1;
      else stat.low += 1;
      return stat;
    }, (err, committed, snap) => {
      if (snap && userKey === currentUserKey) {
        renderUserStats(snap.val());
      }
    });
  }

  function fetchUserStatsOnce() {
    if (!currentUserKey) return;
    db.ref("userStats/" + currentUserKey).once("value").then(snap => {
      if (snap.exists()) {
        renderUserStats(snap.val());
      } else {
        renderUserStats(null);
      }
    });
  }

  // ===== æ’è¡Œæ¦œ =====
  db.ref("userStats").on("value", snapshot => {
    const val = snapshot.val();
    if (!val) {
      leaderboardList.innerHTML = '<li class="empty-tip">æš‚æ—¶æ²¡æœ‰æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œå‡ æ¬¡é£Ÿç‰©æŸ¥è¯¢ã€‚</li>';
      return;
    }
    const arr = Object.keys(val).map(k => val[k]);
    arr.sort((a, b) => (b.high || 0) - (a.high || 0));
    const top10 = arr.slice(0, 10);
    leaderboardList.innerHTML = "";

    top10.forEach((u, idx) => {
      const li = document.createElement("li");
      li.className = "leaderboard-item";
      li.innerHTML = `
        <span class="rank">${idx + 1}.</span>
        <span class="name">${escapeHtml(u.userName || "æœªå‘½å")}</span>
        <span class="score">${u.high || 0} æ¬¡å¥åº·é€‰æ‹©</span>
      `;
      leaderboardList.appendChild(li);
    });
  });

  // ===== è¿è¿çœ‹æ¸¸æˆé€»è¾‘ =====
  let gameRows = 6;
  let gameCols = 8;
  let gameBoardData = []; // 2D array
  let firstSelected = null;
  let gameTimer = null;
  let timeLeft = 60;
  let matchedPairs = 0;
  let unlockedTips = 0;
  let gameActive = false;

  const GAME_FOODS = ["è‹¹æœ", "é¦™è•‰", "æ²™æ‹‰", "ç‚¸é¸¡", "æ‹‰é¢", "æ³¡èœæ±¤", "ç´«èœåŒ…é¥­", "ç‰›æ²¹æœ", "ç™½ç±³é¥­", "å¯ä¹"];

  function initBoard(rows, cols) {
    gameRows = rows;
    gameCols = cols;

    const totalCells = rows * cols;
    const pairCount = totalCells / 2;
    const selectedFoods = [];
    let idx = 0;
    for (let i = 0; i < pairCount; i++) {
      const food = GAME_FOODS[idx % GAME_FOODS.length];
      selectedFoods.push(food, food);
      idx++;
    }

    // shuffle
    for (let i = selectedFoods.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [selectedFoods[i], selectedFoods[j]] = [selectedFoods[j], selectedFoods[i]];
    }

    // å¡«å……å¸¦è¾¹æ¡†çš„äºŒç»´æ•°ç»„ï¼ˆå¤šä¸€åœˆç©ºç™½ï¼‰
    gameBoardData = [];
    for (let r = 0; r < rows + 2; r++) {
      const row = [];
      for (let c = 0; c < cols + 2; c++) {
        row.push(null);
      }
      gameBoardData.push(row);
    }

    let k = 0;
    for (let r = 1; r <= rows; r++) {
      for (let c = 1; c <= cols; c++) {
        gameBoardData[r][c] = selectedFoods[k++];
      }
    }

    // æ¸²æŸ“æ£‹ç›˜
    renderBoard();
  }

  function renderBoard() {
    gameBoard.innerHTML = "";
    gameBoard.style.gridTemplateColumns = `repeat(${gameCols}, 1fr)`;

    for (let r = 1; r <= gameRows; r++) {
      for (let c = 1; c <= gameCols; c++) {
        const foodKey = gameBoardData[r][c];
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.dataset.row = r;
        tile.dataset.col = c;
        if (!foodKey) {
          tile.classList.add("empty");
        } else {
          const food = FOOD_DATA[foodKey] || {};
          const emoji = food.emoji || "ğŸ½";
          tile.innerHTML = `<span>${emoji}</span>`;
        }

        tile.addEventListener("click", () => {
          if (!gameActive) return;
          onTileClick(r, c, tile);
        });

        gameBoard.appendChild(tile);
      }
    }
  }

  function onTileClick(r, c, tileElement) {
    const value = gameBoardData[r][c];
    if (!value) return;

    if (!firstSelected) {
      firstSelected = { r, c, value, tile: tileElement };
      tileElement.classList.add("selected");
      return;
    }

    const { r: r1, c: c1, value: v1, tile: tile1 } = firstSelected;
    if (r1 === r && c1 === c) {
      return; // ç‚¹å‡»åŒä¸€ä¸ªæ ¼å­
    }

    // ç¬¬äºŒæ¬¡ç‚¹å‡»
    if (v1 !== value) {
      // ä¸åŒé£Ÿç‰© â†’ ç®€å•é—ªåŠ¨
      tile1.classList.remove("selected");
      firstSelected = null;
      return;
    }

    // åŒä¸€ç§é£Ÿç‰©ï¼Œæ£€æŸ¥æ˜¯å¦å¯è¿æ¥
    if (canConnect(r1, c1, r, c)) {
      // æ¶ˆé™¤
      gameBoardData[r1][c1] = null;
      gameBoardData[r][c] = null;
      tile1.classList.add("empty");
      tileElement.classList.add("empty");
      tile1.classList.remove("selected");
      matchedPairs++;
      gameMatchedLabel.textContent = matchedPairs;

      // æ˜¾ç¤ºè¥å…»æç¤º
      showNutritionTip(value);

      // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨æ¸…ç©º
      if (isBoardCleared()) {
        endGame(true);
      }
    } else {
      tile1.classList.remove("selected");
    }
    firstSelected = null;
  }

  function isBoardCleared() {
    for (let r = 1; r <= gameRows; r++) {
      for (let c = 1; c <= gameCols; c++) {
        if (gameBoardData[r][c]) return false;
      }
    }
    return true;
  }

  // è¿æ¥åˆ¤æ–­ï¼š0~2ä¸ªæ‹ç‚¹
  function isClearRow(r, c1, c2) {
    const [start, end] = c1 < c2 ? [c1, c2] : [c2, c1];
    for (let c = start + 1; c < end; c++) {
      if (gameBoardData[r][c]) return false;
    }
    return true;
  }

  function isClearCol(c, r1, r2) {
    const [start, end] = r1 < r2 ? [r1, r2] : [r2, r1];
    for (let r = start + 1; r < end; r++) {
      if (gameBoardData[r][c]) return false;
    }
    return true;
  }

  function canConnect(r1, c1, r2, c2) {
    if (r1 === r2 && c1 === c2) return false;
    if (gameBoardData[r1][c1] === null || gameBoardData[r2][c2] === null) return false;
    if (gameBoardData[r1][c1] !== gameBoardData[r2][c2]) return false;

    // 0 æ‹ç‚¹ï¼šåŒè¡Œæˆ–åŒåˆ—æ— éšœç¢
    if (r1 === r2 && isClearRow(r1, c1, c2)) return true;
    if (c1 === c2 && isClearCol(c1, r1, r2)) return true;

    // 1 æ‹ç‚¹ï¼šå°è¯•ä¸¤ä¸ªâ€œæ‹ç‚¹â€
    // æ‹ç‚¹ A: (r1, c2)
    if (!gameBoardData[r1][c2] && isClearRow(r1, c1, c2) && isClearCol(c2, r1, r2)) {
      return true;
    }
    // æ‹ç‚¹ B: (r2, c1)
    if (!gameBoardData[r2][c1] && isClearCol(c1, r1, r2) && isClearRow(r2, c1, c2)) {
      return true;
    }

    // 2 æ‹ç‚¹ï¼šæ‰«ææ‰€æœ‰å¯èƒ½è¡Œ
    const maxR = gameRows + 1;
    const maxC = gameCols + 1;

    // ç«–å‘æ‰©å±•
    for (let r = 0; r <= maxR; r++) {
      if (!gameBoardData[r][c1] && !gameBoardData[r][c2] &&
          isClearCol(c1, r1, r) && isClearRow(r, c1, c2) && isClearCol(c2, r, r2)) {
        return true;
      }
    }

    // æ°´å¹³æ‰©å±•
    for (let c = 0; c <= maxC; c++) {
      if (!gameBoardData[r1][c] && !gameBoardData[r2][c] &&
          isClearRow(r1, c1, c) && isClearCol(c, r1, r2) && isClearRow(r2, c, c2)) {
        return true;
      }
    }

    return false;
  }

  function showNutritionTip(foodKey) {
    const food = FOOD_DATA[foodKey] || {};
    const tip = NUTRITION_TIPS[foodKey] || food.tips || "æ³¨æ„é¥®é£Ÿå‡è¡¡ï¼Œå¤šæ ·åŒ–æ‘„å…¥ä¸åŒé£Ÿç‰©ã€‚";
    gameTipFood.textContent = `${food.emoji || "ğŸ½"} ${food.nameCN || foodKey}`;
    gameTipText.textContent = tip;
    gameTipBubble.style.display = "flex";
    unlockedTips++;
    gameTipsLabel.textContent = unlockedTips;

    setTimeout(() => {
      gameTipBubble.style.display = "none";
    }, 2800);
  }

  function resetGameState() {
    timeLeft = 60;
    matchedPairs = 0;
    unlockedTips = 0;
    gameActive = false;
    firstSelected = null;
    gameTimeLabel.textContent = "60s";
    gameMatchedLabel.textContent = "0";
    gameTipsLabel.textContent = "0";
    timerBar.style.width = "100%";
    gameTipBubble.style.display = "none";
    clearInterval(gameTimer);
  }

  function startGame() {
    resetGameState();
    initBoard(6, 8); // ç®€åŒ–ç‰ˆï¼Œå›ºå®š 6x8 æ£‹ç›˜
    gameActive = true;
    let total = timeLeft;
    timerBar.style.width = "100%";

    gameTimer = setInterval(() => {
      timeLeft--;
      if (timeLeft < 0) {
        clearInterval(gameTimer);
        gameActive = false;
        endGame(false);
        return;
      }
      gameTimeLabel.textContent = timeLeft + "s";
      const percent = (timeLeft / total) * 100;
      timerBar.style.width = percent + "%";
    }, 1000);
  }

  function endGame(success) {
    clearInterval(gameTimer);
    gameActive = false;

    if (success) {
      gameOverlayTitle.textContent = "ğŸ‰ æœ¬å±€å®Œæˆï¼";
      gameOverlayDesc.textContent = "ä½ åœ¨é™å®šæ—¶é—´å†…æˆåŠŸæ¶ˆé™¤äº†æ‰€æœ‰é£Ÿç‰©å¡ç‰‡ã€‚";
    } else {
      gameOverlayTitle.textContent = "â± æ—¶é—´åˆ°";
      gameOverlayDesc.textContent = "æœ¬å±€æ—¶é—´å·²ç»“æŸï¼Œå¯ä»¥å†å°è¯•ä¸€æ¬¡å“¦ã€‚";
    }

    const used = 60 - Math.max(0, timeLeft);
    gameOverlayStats.textContent =
      `ç”¨æ—¶ï¼š${used} ç§’ Â· å®ŒæˆåŒ¹é…ï¼š${matchedPairs} å¯¹ Â· è§£é”è¥å…»æç¤ºï¼š${unlockedTips} æ¡`;

    gameOverlay.style.display = "flex";
  }

  startGameBtn.addEventListener("click", () => {
    startGame();
  });

  restartGameBtn.addEventListener("click", () => {
    startGame();
  });

  overlayRestartBtn.addEventListener("click", () => {
    gameOverlay.style.display = "none";
    startGame();
  });

  overlayCloseBtn.addEventListener("click", () => {
    gameOverlay.style.display = "none";
  });
</script>
</body>
</html>
