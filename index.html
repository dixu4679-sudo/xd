<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å¥åº·é¥®é£ŸåŠ©æ‰‹ Â· Healthy Food Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ç®€å•ä½†å¥½çœ‹çš„å†…è”æ ·å¼ -->
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --primary: #4b7bec;
      --primary-soft: #e4edff;
      --danger: #ff7675;
      --text-main: #2d3436;
      --text-sub: #636e72;
      --border-soft: #dfe6e9;
      --success: #00b894;
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Noto Sans CJK SC", "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #e3f2fd 0, #f5f7fb 48%, #f5f7fb 100%);
      color: var(--text-main);
    }

    .app {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px 32px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    header .title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      margin: 0;
      font-size: 26px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.emoji {
      font-size: 30px;
    }

    .subtitle {
      margin: 0;
      font-size: 13px;
      color: var(--text-sub);
    }

    .login-card {
      background: var(--card);
      border-radius: 14px;
      padding: 12px 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      min-width: 260px;
    }

    .login-card label {
      font-size: 14px;
      white-space: nowrap;
    }

    .login-card input {
      flex: 1;
      min-width: 130px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 6px 10px;
      font-size: 14px;
      outline: none;
      transition: all .15s ease;
    }

    .login-card input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(75,126,236,0.18);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 14px;
      cursor: pointer;
      transition: all .15s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(75,126,236,0.35);
    }

    .btn-ghost {
      background: transparent;
      color: var(--primary);
    }

    .btn-ghost:hover {
      background: var(--primary-soft);
    }

    .current-user {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    main {
      margin-top: 16px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px 18px 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      border: 1px solid rgba(255,255,255,0.6);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      font-size: 18px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-sub);
    }

    .field-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .field-row input,
    .field-row select {
      flex: 1;
      min-width: 140px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 6px 10px;
      font-size: 14px;
      outline: none;
      transition: all .15s ease;
      background: #fdfefe;
    }

    .field-row input:focus,
    .field-row select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(75,126,236,0.18);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      font-size: 11px;
      color: var(--text-sub);
      background: #f9fafb;
      cursor: pointer;
      transition: all .12s ease;
    }

    .chip:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: #eef3ff;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .stat-box {
      border-radius: 12px;
      padding: 10px 12px;
      background: #f7f9ff;
      border: 1px solid #dde4ff;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      color: var(--text-sub);
      font-size: 11px;
    }

    .stat-value {
      font-weight: 600;
      font-size: 14px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      white-space: nowrap;
    }

    .tag-green {
      background: rgba(0,184,148,0.12);
      color: #00b894;
    }

    .tag-orange {
      background: rgba(255,159,67,0.12);
      color: #e67e22;
    }

    .tag-red {
      background: rgba(255,118,117,0.12);
      color: #d63031;
    }

    .recipes {
      margin-top: 8px;
      font-size: 13px;
      line-height: 1.5;
    }

    .recipes h4 {
      margin: 6px 0 4px;
      font-size: 13px;
      font-weight: 600;
    }

    .recipes ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    .recipes li {
      margin-bottom: 3px;
    }

    .empty {
      font-size: 13px;
      color: var(--text-sub);
      padding: 4px 0;
    }

    .leaderboard-list {
      list-style: none;
      padding: 0;
      margin: 10px 0 0;
      font-size: 13px;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      border-bottom: 1px dashed #ecf0f1;
    }

    .leaderboard-item span.rank {
      font-size: 11px;
      color: var(--text-sub);
      width: 20px;
    }

    .leaderboard-item span.food {
      flex: 1;
      padding: 0 4px;
    }

    .leaderboard-item span.count {
      font-size: 12px;
      color: var(--primary);
      font-weight: 600;
    }

    .badge {
      font-size: 11px;
      padding: 0 6px;
      border-radius: 999px;
      background: #f1f3f5;
      color: var(--text-sub);
    }

    footer {
      margin-top: 18px;
      font-size: 11px;
      text-align: center;
      color: var(--text-sub);
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">
      <h1><span class="emoji">ğŸ¥—</span> å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ <span style="font-size:14px;color:#636e72;">Healthy Food Helper</span></h1>
      <p class="subtitle">è¾“å…¥é£Ÿç‰©åç§°å³å¯æŸ¥çœ‹çƒ­é‡ä¸è¥å…»ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ•°æ®æ˜¾ç¤ºç®€å•é£Ÿè°±å»ºè®®ä¸çƒ­é—¨é£Ÿç‰©æ’è¡Œã€‚</p>
    </div>

    <div class="login-card">
      <label for="userName">ğŸ‘¤ æ˜µç§° / å­¦å·ï¼š</label>
      <input id="userName" type="text" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
      <button class="btn btn-primary" id="loginBtn">ç™»å½• / ì‹œì‘í•˜ê¸°</button>
      <div class="current-user" id="currentUser">å½“å‰æœªç™»å½•</div>
    </div>
  </header>

  <main id="mainSection" style="opacity:0.2;pointer-events:none;">
    <!-- å·¦ä¾§ï¼šé£Ÿç‰©æŸ¥è¯¢ + ç»“æœ -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title"><span class="icon">ğŸ”</span> é£Ÿç‰©æŸ¥è¯¢ / ì¹¼ë¡œë¦¬ ê²€ìƒ‰</div>
          <div class="card-subtitle">è¾“å…¥å¸¸è§é£Ÿç‰©åç§°ï¼ˆä¾‹å¦‚ï¼šè‹¹æœã€æ²™æ‹‰ã€ç‚¸é¸¡ã€æ‹‰é¢ç­‰ï¼‰ã€‚è‹¥æœªçŸ¥é£Ÿç‰©ï¼Œå°†ç»™å‡ºæç¤ºã€‚</div>
        </div>
        <button class="btn btn-ghost" id="clearResultBtn">æ¸…ç©ºç»“æœ</button>
      </div>

      <div class="field-row">
        <input id="foodInput" type="text" placeholder="è¯·è¾“å…¥é£Ÿç‰©ï¼Œå¦‚ï¼šè‹¹æœã€ç‚¸é¸¡ã€æ²™æ‹‰â€¦" list="foodSuggestions">
        <button class="btn btn-primary" id="searchBtn">æŸ¥è¯¢</button>
      </div>

      <datalist id="foodSuggestions">
        <option value="è‹¹æœ">
        <option value="é¦™è•‰">
        <option value="æ²™æ‹‰">
        <option value="ç‚¸é¸¡">
        <option value="æ‹‰é¢">
        <option value="æ³¡èœæ±¤">
        <option value="ç´«èœåŒ…é¥­">
        <option value="ç‰›æ²¹æœ">
        <option value="ç™½ç±³é¥­">
        <option value="å¯ä¹">
      </datalist>

      <div class="chip-row">
        <span class="chip" data-food="è‹¹æœ">ğŸ è‹¹æœ</span>
        <span class="chip" data-food="æ²™æ‹‰">ğŸ¥— æ²™æ‹‰</span>
        <span class="chip" data-food="ç‚¸é¸¡">ğŸ— ç‚¸é¸¡</span>
        <span class="chip" data-food="æ‹‰é¢">ğŸœ æ‹‰é¢</span>
        <span class="chip" data-food="ç´«èœåŒ…é¥­">ğŸ™ ç´«èœåŒ…é¥­</span>
        <span class="chip" data-food="ç‰›æ²¹æœ">ğŸ¥‘ ç‰›æ²¹æœ</span>
      </div>

      <div id="resultArea">
        <p class="empty">ğŸ‘‰ åœ¨ä¸Šæ–¹è¾“å…¥é£Ÿç‰©åç§°å¹¶ç‚¹å‡»â€œæŸ¥è¯¢â€ï¼Œæˆ–ç›´æ¥ç‚¹å‡»ä¸Šé¢çš„æ¨èæ ‡ç­¾ã€‚</p>
      </div>
    </section>

    <!-- å³ä¾§ï¼šçƒ­é—¨é£Ÿç‰©æ’è¡Œæ¦œ -->
    <aside class="card">
      <div class="card-header">
        <div>
          <div class="card-title"><span class="icon">ğŸ“ˆ</span> å®æ—¶çƒ­é—¨é£Ÿç‰© TOP 10</div>
          <div class="card-subtitle">åŸºäº Firebase å®æ—¶æ•°æ®åº“çš„æœç´¢æ¬¡æ•°ç»Ÿè®¡ã€‚</div>
        </div>
      </div>
      <ul class="leaderboard-list" id="leaderboardList">
        <li class="empty">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œå‡ æ¬¡æŸ¥è¯¢ã€‚</li>
      </ul>
    </aside>
  </main>

  <footer>
    Â© 2025 Healthy Food Helper Â· ç»Ÿè®¡å†³ç­– Â· Firebase Realtime Database Demo
  </footer>
</div>

<!-- Firebase v9 compatï¼ˆä¾¿äºå’Œç –å—æ¸¸æˆç¤ºä¾‹åŒé£æ ¼å†™æ³•ï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

const firebaseConfig = {
  apiKey: "AIzaSyAxxxxxxx",
  authDomain: "healthy-eating-and-recreation.firebaseapp.com",
  databaseURL: "https://healthy-eating-and-recreation-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "healthy-eating-and-recreation",
  storageBucket: "healthy-eating-and-recreation.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};


  // åˆå§‹åŒ– Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ç®€å•çš„é£Ÿç‰©è¥å…»æ•°æ®ï¼ˆç¤ºä¾‹ï¼Œå¯ä»¥æŒ‰éœ€æ±‚æ‰©å±•ï¼‰
  const FOOD_DATA = {
    "è‹¹æœ": {
      nameCN: "è‹¹æœ",
      nameEN: "Apple",
      kcalPer100g: 52,
      unit: "100g",
      carbs: 14,
      protein: 0.3,
      fat: 0.2,
      fiber: 2.4,
      category: "å¥åº·æ°´æœ",
      healthLevel: "high",
      tips: "å¯Œå«è†³é£Ÿçº¤ç»´ä¸ç»´ç”Ÿç´ Cï¼Œä½œä¸ºåŠ é¤æˆ–æ—©é¤é…é¤å¾ˆé€‚åˆã€‚",
      recipes: [
        {
          title: "é…¸å¥¶æ°´æœç¢—",
          steps: [
            "åŸå‘³é…¸å¥¶ä¸€ç¢—ï¼ŒåŠ å…¥åˆ‡ç‰‡è‹¹æœã€ç‡•éº¦å’Œå°‘é‡åšæœã€‚",
            "å¯ä»¥å°‘é‡æ·‹ä¸€ç‚¹èœ‚èœœå¢åŠ é£å‘³ã€‚",
            "é€‚åˆä½œä¸ºè½»é£Ÿæ—©é¤æˆ–ä¸‹åˆèŒ¶ã€‚"
          ]
        }
      ]
    },
    "é¦™è•‰": {
      nameCN: "é¦™è•‰",
      nameEN: "Banana",
      kcalPer100g: 89,
      unit: "100g",
      carbs: 23,
      protein: 1.1,
      fat: 0.3,
      fiber: 2.6,
      category: "èƒ½é‡æ°´æœ",
      healthLevel: "medium",
      tips: "å«æœ‰è¾ƒå¤šç³–åˆ†å’Œé’¾ï¼Œè¿åŠ¨å‰åè¡¥å……èƒ½é‡ä¸é”™ï¼Œä½†å‡è„‚æœŸè¦æ³¨æ„é‡ã€‚",
      recipes: [
        {
          title: "é¦™è•‰èŠ±ç”Ÿé…±åå¸",
          steps: [
            "å…¨éº¦åå¸ä¸ŠæŠ¹ä¸€å±‚è–„è–„çš„èŠ±ç”Ÿé…±ã€‚",
            "æ‘†ä¸Šé¦™è•‰ç‰‡ï¼Œæ’’å°‘é‡è‚‰æ¡‚ç²‰ã€‚",
            "é€‚åˆä½œä¸ºé«˜èƒ½é‡æ—©é¤ã€‚"
          ]
        }
      ]
    },
    "æ²™æ‹‰": {
      nameCN: "è”¬èœæ²™æ‹‰",
      nameEN: "Green Salad",
      kcalPer100g: 35,
      unit: "100gï¼ˆä¸å«é‡å£å‘³é…±æ±ï¼‰",
      carbs: 5,
      protein: 1.5,
      fat: 1,
      fiber: 2.5,
      category: "è½»é£Ÿ / å‡è„‚",
      healthLevel: "high",
      tips: "æ³¨æ„é€‰æ‹©æ©„æ¦„æ²¹ã€æŸ æª¬æ±ç­‰æ¸…çˆ½é…±æ±ï¼Œé¿å…é«˜ç³–é«˜è„‚æ²™æ‹‰é…±ã€‚",
      recipes: [
        {
          title: "é¸¡èƒ¸è‚‰æ··åˆè”¬èœæ²™æ‹‰",
          steps: [
            "ç”Ÿèœã€ç´«ç”˜è“ã€å°ç•ªèŒ„ã€é»„ç“œåˆ‡å—æ··åˆã€‚",
            "åŠ å…¥ç…æˆ–ç…®ç†Ÿçš„é¸¡èƒ¸è‚‰å—ã€‚",
            "ç”¨æ©„æ¦„æ²¹+æŸ æª¬æ±+å°‘é‡ç›å’Œé»‘èƒ¡æ¤’è°ƒå‘³ã€‚"
          ]
        }
      ]
    },
    "ç‚¸é¸¡": {
      nameCN: "ç‚¸é¸¡",
      nameEN: "Fried Chicken",
      kcalPer100g: 260,
      unit: "100gï¼ˆå¸¦çš®ï¼‰",
      carbs: 8,
      protein: 18,
      fat: 17,
      fiber: 0,
      category: "é«˜è„‚ / é«˜çƒ­é‡",
      healthLevel: "low",
      tips: "å¶å°”å°‘é‡äº«ç”¨å¯ä»¥ï¼Œä½†è¦æ³¨æ„æ€»çƒ­é‡å’Œæ²¹è„‚æ‘„å…¥ã€‚",
      recipes: [
        {
          title: "çƒ¤ç®±ç‰ˆä½æ²¹é¸¡å—æ›¿ä»£",
          steps: [
            "é¸¡èƒ¸è‚‰åˆ‡å—ï¼Œç”¨å°‘é‡æ©„æ¦„æ²¹ã€å¤§è’œç²‰ã€èƒ¡æ¤’å’Œå°‘è®¸ç›è…Œåˆ¶ã€‚",
            "è£¹ä¸Šå…¨éº¦é¢åŒ…ç³ ï¼Œæ”¾å…¥çƒ¤ç®±çƒ˜çƒ¤è€Œéæ²¹ç‚¸ã€‚",
            "æ­é…æ²™æ‹‰ä¸€èµ·åƒï¼Œå¯é™ä½æ•´ä½“è´Ÿæ‹…ã€‚"
          ]
        }
      ]
    },
    "æ‹‰é¢": {
      nameCN: "æ–¹ä¾¿æ‹‰é¢",
      nameEN: "Instant Ramen",
      kcalPer100g: 450,
      unit: "ä¸€å—é¢é¥¼çº¦ 80g å¹²é‡",
      carbs: 60,
      protein: 9,
      fat: 17,
      fiber: 3,
      category: "é«˜ç› / é«˜è„‚",
      healthLevel: "low",
      tips: "æ³¨æ„æ±¤æ±é’ å«é‡é«˜ï¼Œå¯ä»¥åªç”¨ä¸€åŠè°ƒæ–™åŒ…ï¼Œå¹¶å¤šåŠ è”¬èœå’Œè›‹ã€‚",
      recipes: [
        {
          title: "å‡çº§ç‰ˆè”¬èœé¸¡è›‹æ‹‰é¢",
          steps: [
            "ç…®é¢æ—¶åŠ å…¥å°ç™½èœã€èƒ¡èåœä¸ã€é‡‘é’ˆè‡ç­‰è”¬èœã€‚",
            "åŠ å…¥ä¸€ä¸ªé¸¡è›‹æˆ–è±†è…å—æå‡è›‹ç™½è´¨ã€‚",
            "æ±¤æ–™åŒ…åªç”¨ä¸€åŠï¼Œå‡å°‘ç›åˆ†æ‘„å…¥ã€‚"
          ]
        }
      ]
    },
    "æ³¡èœæ±¤": {
      nameCN: "æ³¡èœæ±¤",
      nameEN: "Kimchi Stew",
      kcalPer100g: 80,
      unit: "ä¸€ç¢—çº¦ 250â€“300g",
      carbs: 6,
      protein: 6,
      fat: 3,
      fiber: 1.5,
      category: "éŸ©å¼å¸¸è§ä¸»é£Ÿé…èœ",
      healthLevel: "medium",
      tips: "æ­é…é€‚é‡ç±³é¥­å’Œé…èœå¯ä»¥æˆä¸ºè¾ƒå‡è¡¡çš„ä¸€é¤ï¼Œæ³¨æ„ç›åˆ†ã€‚",
      recipes: [
        {
          title: "è±†è…çŒªè‚‰æ³¡èœæ±¤",
          steps: [
            "ç”¨å°‘é‡çŒªè‚‰ç‚’é¦™æ³¡èœï¼ŒåŠ å…¥æ´‹è‘±å’Œå¤§è‘±ã€‚",
            "åŠ å…¥æ°´æˆ–é«˜æ±¤ï¼Œå°ç«ç…®å¼€ååŠ å…¥è±†è…å—ã€‚",
            "æœ€åæ ¹æ®å£å‘³åŠ å…¥å°‘é‡è¾£æ¤’ç²‰å’Œé…±æ²¹è°ƒå‘³ã€‚"
          ]
        }
      ]
    },
    "ç´«èœåŒ…é¥­": {
      nameCN: "ç´«èœåŒ…é¥­",
      nameEN: "Gimbap",
      kcalPer100g: 200,
      unit: "ä¸€å·çº¦ 250â€“300g",
      carbs: 30,
      protein: 5,
      fat: 6,
      fiber: 2,
      category: "æ–¹ä¾¿ä¸»é£Ÿ",
      healthLevel: "medium",
      tips: "é€‰æ‹©è”¬èœå’Œè›‹ä¸ºä¸»çš„å†…é¦…å¯ä»¥ç›¸å¯¹æ›´å¥åº·ï¼Œå°‘ç”¨åŠ å·¥è‚‰ç±»ã€‚",
      recipes: [
        {
          title: "è”¬èœé¸¡è›‹ç´«èœåŒ…é¥­",
          steps: [
            "ç”¨é€‚é‡ç±³é¥­é“ºåœ¨ç´«èœä¸Šï¼Œé“ºå¾—ä¸è¦å¤ªåšã€‚",
            "ä¸­é—´æ”¾å…¥é»„ç“œæ¡ã€èƒ¡èåœæ¡ã€é¸¡è›‹æ¡å’Œå°‘é‡èŠéº»æ²¹ã€‚",
            "å·ç´§ååˆ‡æ®µï¼Œå¯æ­é…å‘³å™Œæ±¤æˆ–æ³¡èœä¸€èµ·åƒã€‚"
          ]
        }
      ]
    },
    "ç‰›æ²¹æœ": {
      nameCN: "ç‰›æ²¹æœ",
      nameEN: "Avocado",
      kcalPer100g: 160,
      unit: "100g",
      carbs: 9,
      protein: 2,
      fat: 15,
      fiber: 7,
      category: "ä¼˜è´¨è„‚è‚ª",
      healthLevel: "high",
      tips: "å¯Œå«å•ä¸é¥±å’Œè„‚è‚ªé…¸å’Œçº¤ç»´ï¼Œé€‚é‡æ­é…å…¨éº¦é¢åŒ…æˆ–æ²™æ‹‰éå¸¸é€‚åˆã€‚",
      recipes: [
        {
          title: "ç‰›æ²¹æœé¸¡è›‹åå¸",
          steps: [
            "å…¨éº¦åå¸çƒ¤é¦™åï¼ŒæŠ¹ä¸Šæ£ç¢çš„ç‰›æ²¹æœã€‚",
            "ä¸Šé¢æ”¾ä¸€é¢—æ°´ç…®è›‹æˆ–æºå¿ƒè›‹ï¼Œæ’’å°‘é‡é»‘èƒ¡æ¤’å’Œç›ã€‚",
            "æ˜¯ä¸€ä»½è¥å…»å‡è¡¡çš„ç®€å•æ—©åˆé¤ã€‚"
          ]
        }
      ]
    },
    "ç™½ç±³é¥­": {
      nameCN: "ç™½ç±³é¥­",
      nameEN: "White Rice",
      kcalPer100g: 130,
      unit: "ä¸€ç¢—ç†Ÿé¥­çº¦ 150â€“200g",
      carbs: 28,
      protein: 2.4,
      fat: 0.3,
      fiber: 0.4,
      category: "ä¸»é£Ÿ",
      healthLevel: "medium",
      tips: "æ§åˆ¶ä»½é‡ã€æ­é…è¶³å¤Ÿè”¬èœå’Œè›‹ç™½è´¨ï¼Œç™½ç±³é¥­ä¹Ÿå¯ä»¥æ˜¯å¥åº·é¥®é£Ÿçš„ä¸€éƒ¨åˆ†ã€‚",
      recipes: [
        {
          title: "ä¸€ç¢—å‡è¡¡é…é¥­",
          steps: [
            "ç±³é¥­æ§åˆ¶åœ¨ä¸€ç¢—ä»¥å†…ã€‚",
            "é…ä¸€ä»½è”¬èœç±»å°èœï¼ˆå‡‰æ‹Œæˆ–æ¸…ç‚’ï¼‰ã€‚",
            "å†é…ä¸€ä»½è›‹ç™½è´¨ï¼Œå¦‚é¸¡èƒ¸è‚‰ã€è±†è…æˆ–é±¼ã€‚"
          ]
        }
      ]
    },
    "å¯ä¹": {
      nameCN: "å¯ä¹é¥®æ–™",
      nameEN: "Cola",
      kcalPer100g: 42,
      unit: "ä¸€å¬ 330ml çº¦ 140 kcal",
      carbs: 11,
      protein: 0,
      fat: 0,
      fiber: 0,
      category: "å«ç³–é¥®æ–™",
      healthLevel: "low",
      tips: "å‡ ä¹åªæä¾›ç³–åˆ†å’Œçƒ­é‡ï¼Œå»ºè®®å°½é‡å‡å°‘é¢‘ç‡ï¼Œå¯é€‰æ‹©æ— ç³–ç‰ˆæœ¬æˆ–ç™½å¼€æ°´ / æ°”æ³¡æ°´æ›¿ä»£ã€‚",
      recipes: [
        {
          title: "æ— ç³–æ›¿ä»£é¥®å“å°å»ºè®®",
          steps: [
            "å°è¯•æ— ç³–æ°”æ³¡æ°´åŠ æŸ æª¬ç‰‡æˆ–é’æŸ ç‰‡ã€‚",
            "æˆ–è€…è‡ªåˆ¶å†·æ³¡èŒ¶ä»£æ›¿å«ç³–é¥®æ–™ã€‚",
            "å‡å°‘å«ç³–é¥®æ–™æ‘„å…¥æœ‰åŠ©äºæ§åˆ¶ä½“é‡å’Œè¡€ç³–æ³¢åŠ¨ã€‚"
          ]
        }
      ]
    }
  };

  let currentUser = null;

  const userNameInput = document.getElementById("userName");
  const loginBtn = document.getElementById("loginBtn");
  const currentUserLabel = document.getElementById("currentUser");
  const mainSection = document.getElementById("mainSection");
  const foodInput = document.getElementById("foodInput");
  const searchBtn = document.getElementById("searchBtn");
  const resultArea = document.getElementById("resultArea");
  const leaderboardList = document.getElementById("leaderboardList");
  const clearResultBtn = document.getElementById("clearResultBtn");
  const chips = document.querySelectorAll(".chip");

  loginBtn.addEventListener("click", () => {
    const name = userNameInput.value.trim();
    if (!name) {
      alert("è¯·å…ˆè¾“å…¥ä½ çš„æ˜µç§°æˆ–å­¦å·ã€‚");
      userNameInput.focus();
      return;
    }
    currentUser = name;
    currentUserLabel.textContent = "å½“å‰ç”¨æˆ·ï¼š" + currentUser;
    mainSection.style.opacity = "1";
    mainSection.style.pointerEvents = "auto";
  });

  // å›è½¦ç™»å½•ä¼˜åŒ–
  userNameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      loginBtn.click();
    }
  });

  // æŸ¥è¯¢æŒ‰é’®
  searchBtn.addEventListener("click", () => {
    const name = foodInput.value.trim();
    if (!name) {
      alert("è¯·è¾“å…¥é£Ÿç‰©åç§°ã€‚");
      return;
    }
    handleSearch(name);
  });

  // å›è½¦æŸ¥è¯¢ä¼˜åŒ–
  foodInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      searchBtn.click();
    }
  });

  // å¿«æ·æ ‡ç­¾
  chips.forEach(chip => {
    chip.addEventListener("click", () => {
      const foodName = chip.getAttribute("data-food");
      foodInput.value = foodName;
      handleSearch(foodName);
    });
  });

  // æ¸…ç©ºç»“æœ
  clearResultBtn.addEventListener("click", () => {
    resultArea.innerHTML = '<p class="empty">ğŸ‘‰ å·²æ¸…ç©ºç»“æœï¼Œè¯·é‡æ–°è¾“å…¥é£Ÿç‰©åç§°è¿›è¡ŒæŸ¥è¯¢ã€‚</p>';
  });

  function handleSearch(nameRaw) {
    // å¯åšç®€å•è§„èŒƒåŒ–ï¼šå»æ‰ç©ºæ ¼
    const name = nameRaw.replace(/\s+/g, "");
    const data = FOOD_DATA[name];

    if (!data) {
      resultArea.innerHTML = `
        <p class="empty">æš‚æœªæ”¶å½• <strong>${escapeHtml(nameRaw)}</strong> çš„è¯¦ç»†ä¿¡æ¯ã€‚ä½ å¯ä»¥å°è¯•ä½¿ç”¨æ›´å¸¸è§çš„é£Ÿç‰©åç§°ï¼ˆå¦‚â€œè‹¹æœâ€â€œæ²™æ‹‰â€â€œç‚¸é¸¡â€â€œæ‹‰é¢â€ç­‰ï¼‰ï¼Œæˆ–åœ¨æŠ¥å‘Šä¸­è¯´æ˜è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ç³»ç»Ÿã€‚</p>
      `;
      return;
    }

    // æ˜¾ç¤ºç»“æœ
    renderFoodResult(data);

    // å°†æŸ¥è¯¢è®°å½•å†™å…¥ Firebaseï¼ˆç”¨äºç»Ÿè®¡çƒ­é—¨é£Ÿç‰©ï¼‰
    try {
      const payload = {
        user: currentUser || "Guest",
        foodName: data.nameCN,
        foodKey: name,
        timestamp: Date.now()
      };
      db.ref("foodSearchLogs").push(payload);
    } catch (err) {
      console.warn("å†™å…¥ Firebase å‡ºé”™ï¼š", err);
    }
  }

  function getHealthTag(level) {
    if (level === "high") {
      return '<span class="tag tag-green">å¥åº·æ¨è</span>';
    } else if (level === "medium") {
      return '<span class="tag tag-orange">é€‚é‡é£Ÿç”¨</span>';
    } else {
      return '<span class="tag tag-red">æ³¨æ„æ§åˆ¶</span>';
    }
  }

  function renderFoodResult(data) {
    const { nameCN, nameEN, kcalPer100g, unit, carbs, protein, fat, fiber, category, healthLevel, tips, recipes } = data;

    let recipeHtml = "";
    if (recipes && recipes.length > 0) {
      recipeHtml += '<div class="recipes"><h4>ğŸ½ æ¨èé£Ÿè°± / Recipe</h4>';
      recipeHtml += '<ul>';
      recipes.forEach(r => {
        recipeHtml += `<li><strong>${escapeHtml(r.title)}ï¼š</strong>`;
        if (r.steps && r.steps.length) {
          recipeHtml += "<ul>";
          r.steps.forEach(s => {
            recipeHtml += `<li>${escapeHtml(s)}</li>`;
          });
          recipeHtml += "</ul>";
        }
        recipeHtml += "</li>";
      });
      recipeHtml += '</ul></div>';
    }

    resultArea.innerHTML = `
      <div class="result-grid">
        <div class="stat-box">
          <div class="stat-label">é£Ÿç‰©åç§°</div>
          <div class="stat-value">${escapeHtml(nameCN)} <span class="badge">${escapeHtml(nameEN)}</span></div>
          <div style="margin-top:4px;">ç±»å‹ï¼š${escapeHtml(category)} ${getHealthTag(healthLevel)}</div>
        </div>

        <div class="stat-box">
          <div class="stat-label">èƒ½é‡ / Energy</div>
          <div class="stat-value">${kcalPer100g} kcal</div>
          <div style="font-size:11px;color:#636e72;">å‚è€ƒå•ä½ï¼š${escapeHtml(unit)}</div>
        </div>

        <div class="stat-box">
          <div class="stat-label">ç¢³æ°´ / è›‹ç™½è´¨ / è„‚è‚ª</div>
          <div class="stat-value">${carbs}g / ${protein}g / ${fat}g</div>
          <div style="font-size:11px;color:#636e72;">è†³é£Ÿçº¤ç»´çº¦ ${fiber}g</div>
        </div>

        <div class="stat-box">
          <div class="stat-label">ç®€è¦å»ºè®®</div>
          <div style="font-size:13px;line-height:1.5;">${escapeHtml(tips)}</div>
        </div>
      </div>
      ${recipeHtml}
    `;
  }

  // ç›‘å¬ Firebase ç»Ÿè®¡çƒ­é—¨é£Ÿç‰©
  db.ref("foodSearchLogs").on("value", snapshot => {
    const val = snapshot.val();
    if (!val) {
      leaderboardList.innerHTML = '<li class="empty">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œå‡ æ¬¡æŸ¥è¯¢ã€‚</li>';
      return;
    }
    const counts = {};
    Object.keys(val).forEach(key => {
      const log = val[key];
      if (!log || !log.foodKey) return;
      const fk = log.foodKey;
      if (!counts[fk]) {
        counts[fk] = { count: 0, name: log.foodName || fk };
      }
      counts[fk].count += 1;
    });

    const items = Object.keys(counts)
      .map(k => counts[k])
      .sort((a, b) => b.count - a.count)
      .slice(0, 10);

    if (items.length === 0) {
      leaderboardList.innerHTML = '<li class="empty">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œå‡ æ¬¡æŸ¥è¯¢ã€‚</li>';
      return;
    }

    leaderboardList.innerHTML = "";
    items.forEach((item, idx) => {
      const li = document.createElement("li");
      li.className = "leaderboard-item";
      li.innerHTML = `
        <span class="rank">${idx + 1}.</span>
        <span class="food">${escapeHtml(item.name)}</span>
        <span class="count">${item.count} æ¬¡</span>
      `;
      leaderboardList.appendChild(li);
    });
  });

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, function (m) {
      switch (m) {
        case "&": return "&amp;";
        case "<": return "&lt;";
        case ">": return "&gt;";
        case '"': return "&quot;";
        case "'": return "&#39;";
        default: return m;
      }
    });
  }
</script>
</body>
</html>
