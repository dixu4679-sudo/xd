<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ Â· Healthy Food Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, "Noto Sans CJK SC", "Noto Sans KR", sans-serif;
      background: #f5f7fb;
      color: #2d3436;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 10px;
    }
    .login-box, .search-box, .result-box, .rank-box {
      background: #fff;
      padding: 16px;
      margin-top: 16px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    input, button {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #4b7bec;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      filter: brightness(1.1);
    }
    .food-item {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>

<div class="container">

  <h1>ğŸ¥— å¥åº·é¥®é£Ÿé€‰æ‹©åŠ©æ‰‹ Healthy Food Helper</h1>

  <!-- ç™»å½•æ¨¡å— -->
  <div class="login-box">
    <h3>ç™»å½• / ì‹œì‘í•˜ê¸°</h3>
    <input type="text" id="userName" placeholder="è¯·è¾“å…¥æ˜µç§°æˆ–å­¦å·" />
    <button id="loginBtn">ç™»å½•</button>
    <p id="currentUser" style="color:#555;margin-top:6px;">å½“å‰æœªç™»å½•</p>
  </div>

  <!-- æœç´¢æ¨¡å— -->
  <div class="search-box">
    <h3>é£Ÿç‰©æŸ¥è¯¢ / ì¹¼ë¡œë¦¬ ê²€ìƒ‰</h3>
    <input type="text" id="foodInput" placeholder="è¾“å…¥é£Ÿç‰©åç§°â€¦" />
    <button id="searchBtn">æŸ¥è¯¢</button>
  </div>

  <!-- æ˜¾ç¤ºç»“æœ -->
  <div class="result-box">
    <h3>æŸ¥è¯¢ç»“æœ</h3>
    <div id="resultArea">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆæŸ¥è¯¢ã€‚</div>
  </div>

  <!-- æ’è¡Œæ¦œ -->
  <div class="rank-box">
    <h3>ğŸ”¥ çƒ­é—¨é£Ÿç‰© TOP 10</h3>
    <div id="rankList">åŠ è½½ä¸­â€¦</div>
  </div>

</div>

<!-- Firebase JS SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
/* ---------------- Firebase é…ç½®ï¼ˆä½ çš„çœŸå®é…ç½®ï¼‰ ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBCrHD2f3beCX83FZwpCCqMf2lT7WeF8Lg",
  authDomain: "healthy-eating-and-recreation.firebaseapp.com",
  databaseURL: "https://healthy-eating-and-recreation-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "healthy-eating-and-recreation",
  storageBucket: "healthy-eating-and-recreation.appspot.com",
  messagingSenderId: "282757556302",
  appId: "1:282757556302:web:df373651ffe71efca1bb1f",
  measurementId: "G-BPG2KSLHF7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------------- ç®€å•é£Ÿç‰©æ•°æ®åº“ ---------------- */
const FOOD_DATA = {
  "è‹¹æœ": { kcal: 52, info: "å¯Œå«ç»´ç”Ÿç´  C å’Œè†³é£Ÿçº¤ç»´ã€‚" },
  "ç‚¸é¸¡": { kcal: 260, info: "é«˜è„‚è‚ªé«˜çƒ­é‡ï¼Œé€‚é‡é£Ÿç”¨ã€‚" },
  "æ²™æ‹‰": { kcal: 35, info: "ä½çƒ­é‡ï¼Œé«˜çº¤ç»´ï¼Œæœ‰åŠ©å‡è„‚ã€‚" },
  "æ‹‰é¢": { kcal: 450, info: "é«˜ç›é«˜è„‚ï¼Œå»ºè®®åŠ è”¬èœã€‚" },
  "ç´«èœåŒ…é¥­": { kcal: 200, info: "ç¢³æ°´è¾ƒé«˜ï¼Œå¯é€‚é‡ã€‚" },
  "ç‰›æ²¹æœ": { kcal: 160, info: "ä¼˜è´¨è„‚è‚ªæ¥æºã€‚" }
};

/* ---------------- ç™»å½•åŠŸèƒ½ ---------------- */
let currentUser = null;
document.getElementById("loginBtn").onclick = () => {
  const name = document.getElementById("userName").value.trim();
  if (!name) return alert("è¯·è¾“å…¥æ˜µç§°æˆ–å­¦å·ï¼");
  currentUser = name;
  document.getElementById("currentUser").innerText = "å½“å‰ç”¨æˆ·ï¼š" + currentUser;
};

/* ---------------- æœç´¢åŠŸèƒ½ ---------------- */
document.getElementById("searchBtn").onclick = () => {
  const name = document.getElementById("foodInput").value.trim();
  if (!name) return alert("è¯·è¾“å…¥é£Ÿç‰©ï¼");

  if (!FOOD_DATA[name]) {
    document.getElementById("resultArea").innerHTML = "æ•°æ®åº“ä¸­æš‚æ— è¯¥é£Ÿç‰©ã€‚";
    return;
  }

  const f = FOOD_DATA[name];
  document.getElementById("resultArea").innerHTML =
    `<strong>${name}</strong><br>çƒ­é‡ï¼š${f.kcal} kcal<br>${f.info}`;

  // å†™å…¥ Firebase ç»Ÿè®¡è®°å½•
  db.ref("logs").push({
    user: currentUser || "Guest",
    food: name,
    timestamp: Date.now()
  });
};

/* ---------------- æ’è¡Œæ¦œå®æ—¶æ›´æ–° ---------------- */
db.ref("logs").on("value", snapshot => {
  const logs = snapshot.val();
  if (!logs) {
    document.getElementById("rankList").innerHTML = "æš‚æ— æ•°æ®ã€‚";
    return;
  }

  const count = {};
  Object.values(logs).forEach(log => {
    if (!count[log.food]) count[log.food] = 0;
    count[log.food]++;
  });

  const items = Object.entries(count)
    .sort((a,b) => b[1]-a[1])
    .slice(0,10)
    .map(([name, times]) => `<div class="food-item"><span>${name}</span><span>${times} æ¬¡</span></div>`);

  document.getElementById("rankList").innerHTML = items.join("");
});
</script>

</body>
</html>
